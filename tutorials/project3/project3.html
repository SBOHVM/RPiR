<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Project 3: Shannon entropy and the Berger-Parker index</title>

<!-- HEAD_CONTENT -->

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="section-header">



<h1 class="title toc-ignore">Project 3: Shannon entropy and the
Berger-Parker index</h1>

</div>


<div id="section-overview" class="section level2">
<h2>Overview</h2>
<p>We are now going to look at two special cases, where the equation we
used before needs to be adapted – Shannon entropy, which is <span
class="math inline">\(\log(D_1)\)</span>, and the Berger-Parker index,
which is <span class="math inline">\(\frac{1}{D_\infty}\)</span>, and
adapt the code to cope with these.</p>
<p><span class="math display">\[D_1 = \prod_{i \in \{1 \dots N_S, p_i
\neq 0\}} p_i^{-p_i}\]</span></p>
<p><span class="math display">\[D_\infty = \frac{1}{\max_i
p_i}\]</span></p>
<div id="section-background" class="section level3">
<h3>Background</h3>
<p><strong>Shannon entropy</strong> is an extremely well-known
mathematical measure of the information content of a set of data. It is
used here as a measure of “surprise” – how surprising the species of the
next individual observed in a sequence is likely to be. Where there is
only 1 species, each observation is the same, and there is no surprise.
However, when there are lots of species that are all equally abundant
(we are ignoring how well mixed the population is), every encounter is
likely to surprise us.</p>
<p>The <strong>Berger-Parker</strong> index simply tells us how dominant
the most abundant species is. It ignores everything else. The lower the
index, the less dominant the most abundant species is, and so the more
other species are also observed.</p>
</div>
</div>
<div id="section-tasks" class="section level2">
<h2>Tasks</h2>
<p>You may want to copy your existing function code from Project 2 as a
starting point for this exercise. If you do, remember that you need
different function names in this exercise so that they don’t
conflict.</p>
<p>You will be writing a function to calculate diversity, and then two
functions to calculate species richness and Simpson diversity from it as
you did in Project 2. Then you need to write two new very simple
functions which calculate the Shannon entropy and the Berger-Parker
index, using the generic function you created above and
<strong>not</strong> by calculating them from scratch (they will also
need the small amount of additional calculation – <strong>Shannon
entropy is actually <span
class="math inline">\(\log(D_1)\)</span></strong> and
<strong>Berger-Parker is <span
class="math inline">\(\frac{1}{D_\infty}\)</span></strong> – as detailed
above in the overview). You will probably find that the functions as
written do not work! You may choose to test what the results should be
again by comparing the outputs from the generic function at <span
class="math inline">\(q=1\)</span> and <span
class="math inline">\(q=\infty\)</span> (infinity, written as
<code>Inf</code> in R) to matching results from the
<code>rdiversity</code> package.</p>
<p>You should see that the generic function from Project 2 produces very
different answers for a value of <span class="math inline">\(q =
1\)</span> and a value near 1 (say <span class="math inline">\(q =
0.99\)</span> or <span class="math inline">\(q = 1.01\)</span>), and
similarly for <span class="math inline">\(q = \infty\)</span> and a
reasonably large number (say <span class="math inline">\(q = 20\)</span>
or <span class="math inline">\(q = 30\)</span>). In fact, you should
actually get errors for exactly 1 and <span
class="math inline">\(\infty\)</span>, though you may in fact just
produce the wrong answers (that are inconsistent with “nearby” numbers).
In the former case, this is because we calculate <span
class="math inline">\(\frac{1}{0}\)</span> in the equation (which is not
a number), and in the latter we have a rounding error and end up
calculating <span class="math inline">\(0^0\)</span> instead of <span
class="math inline">\(0.000001^{0.000001}\)</span> which turn out to be
very different numbers.</p>
<p>You will need to rewrite the general function using:</p>
<pre class="r"><code>if (some_test) {
  # do something
} else if (some_other_test) {
  # do something different
} else {
  # a third thing
}</code></pre>
<p>So that it checks for these two specific values of <span
class="math inline">\(q\)</span>, and instead use the following two
equations:</p>
<p><span class="math display">\[D_1 = \exp(-\sum(p \times
\log(p)))\]</span> which is to say <code>exp(-sum(p * log(p)))</code> in
R, where <code>p</code> is the vector of non-zero species
proportions.</p>
<p><span class="math display">\[D_\infty = \frac{1}{\max(p)}\]</span>
which is just <code>1/max(p)</code> in R. You should to end up writing
the updated general function and the four specific functions that call
this new updated function to calculate the four measures of diversity we
have discussed so far.</p>
<div id="section-running-the-code" class="section level3">
<h3>Running the code</h3>
<p>Run the two new functions again to make sure there are no errors, and
also make sure that the generic function now gives the same (or very
similar) results for 1 and 1.01, and for 20 and <span
class="math inline">\(\infty\)</span>.</p>
</div>
<div id="section-testing-for-equality-to-exact-values"
class="section level3">
<h3>Testing for equality to exact values</h3>
<p><strong>NB</strong> It is just possible that you may find a problem
with the code still not giving you the correct answer when <span
class="math inline">\(q=1\)</span>. You can test for <span
class="math inline">\(q\)</span> being infinity by just by comparing the
value to <code>Inf</code>, but this doesn’t work reliably for other
numbers – what goes wrong is a rounding error that is very common in
computer programming. Whole numbers cannot be correctly represented as
decimals without small errors creeping in – so 1 may actually appear as
1.000000000001 – and testing whether it is then equal to 1 will fail.
Instead you should test whether it is sufficiently close to 1 for your
purposes. Fortunately, we can do this by saying
<code>if (abs(q-1) &lt; 0.000001)</code>, say, instead of
<code>if (q == 1)</code>, which will check whether you are within
0.000001 of 1 (<em>i.e.</em> 0.999999 to 1.000001). I’ve picked
0.000001, but you can pick another value if it seems better. R actually
provides a number for this itself called the “machine epsilon”,
<code>.Machine$double.eps</code>, which is about <span
class="math inline">\(10^{-16}\)</span>, but it may be too small for our
purposes. People often use <code>sqrt(.Machine$double.eps)</code> as a
compromise (about <span class="math inline">\(10^{-8}\)</span>). I
honestly don’t know why except that it looks quite technical, but feel
free to use it if you like!</p>
</div>
</div>
<div id="section-demo" class="section level2">
<h2>Demo</h2>
<p>Now write a demo that loads in this new functionality and then
calculates the four diversity measures we have discussed for each
dataset.</p>
<p>The demo should then call the general function directly (not the 4
specific functions) and just calculate the general diversity measures
for the datasets provided with <span class="math inline">\(q =
0\)</span>, 1, 2, and <span class="math inline">\(\infty\)</span>
(remember, these correspond to the 4 individual diversity measures we
have investigated so far). Do you see a progression in the values you
observe within each set of population counts as <span
class="math inline">\(q\)</span> increases? Comment on this in the
report. 
<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)
tutorial_options(exercise.reveal_solution = FALSE)
gradethis::gradethis_setup()

knitr::opts_chunk$set(error = TRUE)
set.seed(123)
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["header-attrs"]},{"type":"character","attributes":{},"value":["2.18"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/pandoc"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["header-attrs.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/bootstrap.min.css"]},{"type":"character","attributes":{},"value":["<style>h1 {font-size: 34px;}\n       h1.title {font-size: 38px;}\n       h2 {font-size: 30px;}\n       h3 {font-size: 24px;}\n       h4 {font-size: 18px;}\n       h5 {font-size: 16px;}\n       h6 {font-size: 12px;}\n       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}\n       pre:not([class]) { background-color: white }<\/style>"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87]}},"value":[{"type":"character","attributes":{},"value":["backports","base","bslib","cachem","callr","checkmate","cli","codetools","colorspace","commonmark","compiler","crayon","curl","datasets","deSolve","devtools","digest","dplyr","ellipsis","evaluate","fansi","fastmap","fs","generics","ggplot2","glue","gradethis","graphics","grDevices","grid","gtable","here","highr","htmltools","htmlwidgets","httpuv","jquerylib","jsonlite","knitr","later","learnr","lifecycle","magrittr","markdown","MASS","memoise","methods","mime","miniUI","munsell","pillar","pkgbuild","pkgconfig","pkgload","prettyunits","processx","profvis","promises","ps","purrr","R6","Rcpp","remotes","rlang","rmarkdown","RPiR","rprojroot","rstudioapi","sass","scales","sessioninfo","shiny","stats","stringi","stringr","tibble","tidyselect","tools","urlchecker","usethis","utf8","utils","vctrs","withr","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["1.4.1","4.2.2","0.4.1","1.0.6","3.7.3","2.1.0","3.4.1","0.2-18","2.0-3","1.8.1","4.2.2","1.5.2","4.3.3","4.2.2","1.34","2.4.5","0.6.30","1.0.10","0.3.2","0.18","1.0.3","1.1.0","1.5.2","0.1.3","3.4.0","1.6.2","0.2.11.9000","4.2.2","4.2.2","4.2.2","0.3.1","1.0.1","0.9","0.5.3","1.5.4","1.6.6","0.1.4","1.8.4","1.41","1.3.0","0.11.2.9000","1.0.3","2.0.3","1.4","7.3-58.1","2.0.1","4.2.2","0.12","0.1.1.1","0.5.0","1.8.1","1.4.0","2.0.3","1.3.2","1.1.1","3.8.0","0.3.7","1.2.0.1","1.7.2","0.3.5","2.5.1","1.0.9","2.4.2","1.0.6","2.18","0.76.25","2.0.3","0.14","0.4.4","1.2.1","1.2.2","1.7.3","4.2.2","1.7.8","1.5.0","3.1.8","1.2.0","4.2.2","1.0.1","2.1.6","1.2.2","4.2.2","0.5.1","2.5.0","0.35","1.8-4","2.3.6"]}]}]}
</script>
<!--/html_preserve-->
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
