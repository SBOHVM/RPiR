<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Project 1: Species richness and Simpson diversity</title>

<!-- HEAD_CONTENT -->

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="section-header">



<h1 class="title toc-ignore">Project 1: Species richness and Simpson diversity</h1>

</div>


<div id="section-overview" class="section level2">
<h2>Overview</h2>
<p>In this series of practicals you will develop the code to calculate a few diversity measures. In this first exercise we will calculate the species richness and Simpson diversity of a population.</p>
<div id="section-background" class="section level3">
<h3>Background</h3>
<p>R provides us with many built-in datasets, but sadly none of them are counts of species abundances, so you will use the famous Barro Colorado Island dataset, a 30+ year study of a 50-hectare forest plot in Panama. We will use the number of trees in the study site in 2010, which you have access to from the package you developed in Practical Series 4.</p>
<p>You will also construct a couple of fake datasets that you will use for comparison. Calculating the diversity of these populations (remembering that there are many, in fact a continuum of, diversity measures) will tell us how many observed species there are – the species richness – and give us measures of how evenly distributed the trees are amongst the tree species (the evenness of the species distribution) by various measures. <strong>Species richness</strong> is a very commonly used measure of diversity, which simply <strong>counts the number of non-zero species abundances</strong>; <strong>Simpson diversity</strong> is also commonly used: it simply <strong>calculates the species proportions from the counts (so the total sums to 1), squares them all individually, and add them all together</strong> – it tells us (amongst other things) how likely two randomly chosen individuals are to be from the same species.</p>
</div>
</div>
<div id="section-tasks" class="section level2">
<h2>Tasks</h2>
<p>This project will be written in the <strong>githubusernameDiversity</strong> package that you set up in the last exercise, with functions being saved in the <span style="color: #dd1c77;">R</span> folder and documented so that they work with the standard R help system, and scripts being saved as demos in the <span style="color: #dd1c77;">demo</span> folder so that they can be run using the <code>demo()</code> function or compiled into reports to read the results with suitable reporting explaining what is happening. In each project exercise you will have to write some functions and (most likely) one script. <em>So now create a demo script for this project and add an entry for it in the <span style="color: #dd1c77;">00Index</span> file in the same folder.</em></p>
<div id="section-the-study-populations" class="section level3">
<h3>The study populations</h3>
<p>We are taking the data from the 2010 census – the true abundances for the whole site can be calculated as follows:</p>
<pre class="r"><code>library(githubusernameBCI) 
tree.pop &lt;- rowSums(bci_2010)</code></pre>
<p>The total counts of trees of different species in this forest plot are now available in the variable <code>tree.pop</code>. We can then do some simple extraction of information from the full species counts:</p>
<pre class="r"><code>species.names &lt;- names(tree.pop) 
num.sp &lt;- length(tree.pop) 
num.trees &lt;- sum(tree.pop) 
mean.trees &lt;- mean(tree.pop)</code></pre>
<p>The next two lines sample a single random quadrat and sum up 10 random quadrats, and store the results in <code>quadrat.pop</code> and <code>quadrat10.pop</code>, respectively:</p>
<pre class="r"><code>quadrat.pop &lt;- rowSums(sample_by_subcommunities(bci_2010, 1)) 
quadrat10.pop &lt;- rowSums(sample_by_subcommunities(bci_2010, 10))</code></pre>
<p>You will also use a handful of fake datasets for comparison:</p>
<pre class="r"><code>one.pop &lt;- c(num.trees, rep(0, num.sp - 1)) 
uneven.pop &lt;- c(num.trees / 2, rep(0, num.sp - 1)) + rep(mean.trees / 2, num.sp) 
mixed.pop &lt;- (1:num.sp) / sum(1:num.sp) * num.trees
even.pop &lt;- rep(mean.trees, num.sp)
rand.pop &lt;- as.vector(rmultinom(1, num.trees, rep(1 / num.sp, num.sp)))
rand50.pop &lt;- as.vector(rmultinom(1, round(num.trees / 50), rep(1 / num.sp, num.sp)))</code></pre>
<p>Remember that <code>rep(x, size)</code> repeats <code>x</code>, <code>size</code> times to make a vector of length <code>size</code>, and <code>rmultinom()</code> draws from the <strong>multinomial distribution</strong>, in this case, <code>rand.pop</code> is a population of 222,715 individuals drawn from 299 species, each equally abundant (<span class="math inline">\(\frac{1}{299}\)</span>). Note that <code>rmultinom()</code> is is in the <code>stats</code> package, so you need to add this to the dependencies of your package now. We won’t tell you about any future dependencies you need to add, but note that you can check what package a function is in by looking in the help file for the function:</p>
<pre class="r"><code>?rmultinom</code></pre>
<p>If you run this in the console, the <strong>Multinom {stats}</strong> in the top left of the help page tells you that this function is in the <code>stats</code> package.</p>
</div>
<div id="section-a-species-richness-function" class="section level3">
<h3>A species richness function</h3>
<p>Then write and document a function that takes a vector of abundances like the data above as an argument and calculates the species richness from it. Remember that the species richness is the number of species whose abundance is not zero. The name of this function should start with the letters <code>p1_</code>, so if you decide to call it <code>species_richness()</code>, you should actually call it <code>p1_species_richness()</code>. This is because you will be making a series of similar functions throughout the project, so they will need to be called <code>p1_species_richness()</code>, <code>p2_species_richness()</code>, <code>p3_species_richness()</code>, <em>etc.</em> to distinguish them.</p>
<p><em>Hint:</em> Applying a test to a vector of numbers, will apply the test to all of the numbers in the vector and produce a vector of booleans (<code>TRUE</code> or <code>FALSE</code>) values, so:</p>
<pre class="r"><code>c(1, 3, 5, 7) &gt; 4</code></pre>
<pre><code>[1] FALSE FALSE  TRUE  TRUE</code></pre>
<p>1 and 3 are not <code>&gt; 4</code> and 5 and 7 are. And then <code>sum()</code> will count the number of <code>TRUE</code>s in such a vector of booleans. So:</p>
<pre class="r"><code>over4s &lt;- (c(1, 3, 5, 7) &gt; 4)
sum(over4s)</code></pre>
<pre><code>[1] 2</code></pre>
<p>If you think about it, you should be able to see how to use these two ideas to count the number of non-zero abundances in a population.</p>
</div>
<div id="section-a-simpson-diversity-function" class="section level3">
<h3>A Simpson diversity function</h3>
<p>Then write and document a second function that will calculate the Simpson diversity of the population, remembering, first, that this measure works with the relative proportions of the species not the total counts and, second, that we can do calculations with the whole vector at once.</p>
</div>
<div id="section-running-the-code" class="section level3">
<h3>Running the code</h3>
<p>Look at the values in the nine population vectors – you could try sorting them using <code>sort(x.pop)</code> and plotting them using <code>plot(sort(x.pop))</code>, <code>barplot(sort(x.pop))</code> (or something more attractive?) to get a clearer idea of what they look like – and decide which you think have the richest species diversity.</p>
<p>Run the two functions on the populations provided as see whether the results of the two diversity measures agree with your assessments. Note that a lower value means a higher diversity for the Simpson diversity measure.</p>
<p><strong>NB</strong> Remember that to make the functions you have written accessible to your demo, you need to document and install them:</p>
<pre class="r"><code>devtools::document()
devtools::install()
library(githubusernameDiversity)
?p1_species_richness</code></pre>
<p>You also need to install the package to use the demos:</p>
<pre class="r"><code>devtools::install()
demo(package = &quot;githubusernameDiversity&quot;)</code></pre>
</div>
</div>
<div id="section-demo" class="section level2">
<h2>Demo</h2>
<p>Edit the demo that you have started above so that it loads in the functions (by calling <code>library(githubusernameDiversity)</code>), reads in the BCI data, and generates a report that shows some kind of plot of each of the series of counts and then calculates their species richness and Simpson diversity. Check that your functions also generate appropriate help files (<em>e.g.</em> <code>?p1_species_richness</code>).</p>
<p>Remember to commit the code once you are happy before moving on to the next exercise – you can always come back later and make further commits if you realise you need to change something. I won’t remind you about this in subsequent exercises.</p>
<div id="section-note-on-function-names" class="section level3">
<h3>Note on function names</h3>
As we said above, note that you will often need to refer back to functions in later exercises (as you did in the practicals) and you will be writing several very similar functions in successive exercises. You will need to make sure they do not have identical names or you won’t be able to call them all. The simplest way of doing this might be to label them by the project exercise number and call them <code>p1_species_richness</code>, <code>p2_species_richness</code>, <em>etc.</em> depending on what exercise you are in, but you are welcome to find a more elegant solution – anything that distinguishes them is fine. 
<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)
tutorial_options(exercise.reveal_solution = FALSE)
gradethis::gradethis_setup()

knitr::opts_chunk$set(error = TRUE)
set.seed(123)
</script>
 <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/bootstrap.min.css"]},{"type":"character","attributes":{},"value":["<style>h1 {font-size: 34px;}\n       h1.title {font-size: 38px;}\n       h2 {font-size: 30px;}\n       h3 {font-size: 24px;}\n       h4 {font-size: 18px;}\n       h5 {font-size: 16px;}\n       h6 {font-size: 12px;}\n       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}\n       pre:not([class]) { background-color: white }<\/style>"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.11"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.11"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.11"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84]}},"value":[{"type":"character","attributes":{},"value":["backports","base","bslib","cachem","callr","checkmate","cli","codetools","colorspace","compiler","crayon","curl","datasets","desc","deSolve","devtools","digest","dplyr","ellipsis","evaluate","fansi","fastmap","fs","generics","ggplot2","glue","gradethis","graphics","grDevices","grid","gtable","highr","htmltools","htmlwidgets","httpuv","jquerylib","jsonlite","knitr","later","learnr","lifecycle","magrittr","markdown","MASS","memoise","methods","mime","munsell","pillar","pkgbuild","pkgconfig","pkgload","prettyunits","processx","promises","ps","purrr","R6","Rcpp","remotes","rlang","rmarkdown","RPiR","rprojroot","rstudioapi","sass","scales","sessioninfo","shiny","stats","stringi","stringr","testthat","tibble","tidyselect","tools","usethis","utf8","utils","vctrs","withr","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["1.2.1","4.1.1","0.3.1","1.0.6","3.7.0","2.0.0","3.0.1","0.2-18","2.0-2","4.1.1","1.4.1","4.3.2","4.1.1","1.4.0","1.30","2.4.2","0.6.28","1.0.7","0.3.2","0.14","0.5.0","1.1.0","1.5.0","0.1.1","3.3.5","1.4.2","0.2.4.9000","4.1.1","4.1.1","4.1.1","0.3.0","0.9","0.5.2","1.5.4","1.6.3","0.1.4","1.7.2","1.36","1.3.0","0.10.1.9016","1.0.1","2.0.1","1.1","7.3-54","2.0.0","4.1.1","0.12","0.5.0","1.6.4","1.2.0","2.0.3","1.2.3","1.1.1","3.5.2","1.2.0.1","1.6.0","0.3.4","2.5.1","1.0.7","2.4.1","0.4.12","2.11","0.71.11","2.0.2","0.13","0.4.0","1.1.1","1.1.1","1.7.1","4.1.1","1.7.5","1.4.0","3.1.0","3.1.5","1.1.1","4.1.1","2.1.2","1.2.2","4.1.1","0.3.8","2.4.2","0.27","1.8-4","2.2.1"]}]}]}
</script>
<!--/html_preserve-->
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
