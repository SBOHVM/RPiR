<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Project 2: A general measure of diversity</title>

<!-- HEAD_CONTENT -->

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="section-header">



<h1 class="title toc-ignore">Project 2: A general measure of
diversity</h1>

</div>


<div id="section-overview" class="section level2">
<h2>Overview</h2>
<p>There is a general series of measures of diversity, which is defined
as follows:</p>
<p><span class="math display">\[D_q = \left( \sum_{i \in \{1 \dots N_S,
p_i \neq 0\}} p_i^q \right)^{\frac{1}{1-q}}\]</span></p>
<p>where <span class="math inline">\(N_s\)</span> is the number of
species that we have observed at least one of, and <span
class="math inline">\(p_i\)</span> is the proportion of individuals that
are in the <span class="math inline">\(i^{th}\)</span> species. <span
class="math inline">\(D_q\)</span> is then the <span
class="math inline">\(q^{th}\)</span> diversity measure.</p>
<p>We can translate this general measure easily into more specific
measures (such as the ones we looked at in Project 1), by setting <span
class="math inline">\(q\)</span> to different values. In this exercise,
we will write a function to calculate this general diversity measure,
and then rewrite the specific functions so they use the general one.</p>
<div id="section-background" class="section level3">
<h3>Background</h3>
<p>Hill developed a unifying series of diversity measures in 1973 that
were closely related to most existing measures (Hill, M. O., 1973.
Diversity and evenness: a unifying notation and its consequences.
<em>Ecology</em>, 54, 427–432) but had a firm mathematical footing,
being based on a measure called the Rényi Entropy (A. Rényi, 1961. On
measures of information and entropy. <em>Proceedings of the 4th Berkeley
Symposium on Mathematics, Statistics and Probability 1960</em>,
pp. 547-561). These have been slightly adapted into the equation above
by Lou Jost (Jost, L., 2006. Entropy and diversity. <em>Oikos</em>, 113,
363-375) to give a series of measures of the <strong>effective number of
species</strong>. You are very likely to be unfamiliar with at least
some of the notation in the equation. That’s fine – it says:</p>
<blockquote>
<p>“For the <span class="math inline">\(q^{th}\)</span> diversity
measure, take the non-zero species proportions (note – proportions, so
they all sum to 1, not counts), and raise them each (individually) to
the power <span class="math inline">\(q\)</span>. Then add all of the
results together, and finally raise the sum to the power <span
class="math inline">\(\frac{1}{1-q}\)</span>.”</p>
</blockquote>
<p>This measure always gives a result between 1 and <span
class="math inline">\(N_s\)</span>, where <span
class="math inline">\(N_s\)</span> is the total number of species. Where
one species completely dominates and the others are not observed we will
see “effectively” only 1 species, and where all species are exactly
equally abundant, we will count them all equally, and effectively see
the full <span class="math inline">\(N_s\)</span> species. Other species
distributions will fall somewhere in between. The species richness of a
population is <span class="math inline">\(D_0\)</span>, and the Simpson
index of a population is <span
class="math inline">\(\frac{1}{D_2}\)</span>.</p>
</div>
</div>
<div id="section-tasks" class="section level2">
<h2>Tasks</h2>
<div id="section-a-diversity-function" class="section level3">
<h3>A diversity function</h3>
<p>Write a function that takes a set of population counts and a value
<span class="math inline">\(q\)</span> as arguments and calculates the
<span class="math inline">\(q^{th}\)</span> diversity measure of the
counts. Remember that the equation described above uses the species
proportions, not the counts themselves.</p>
</div>
<div id="section-new-species-richness-and-simpson-index-functions"
class="section level3">
<h3>New species richness and Simpson index functions</h3>
<p>Now write two more new functions to calculate species richness and
Simpson index that do almost no work themselves, but instead just call
this first function to do the work with the right arguments, and then
transform the results if necessary as detailed above.</p>
<blockquote>
<p>You can see an example of creating functions that call other function
you have written in Practical A-5, or the repository <a
href="https://github.com/SBOHVM/practicalA5">SBOHVM/practicalA5</a>.
Here you can see the general function <a
href="https://github.com/SBOHVM/practicalA5/blob/master/R/muladdpow.R"><code>muladdpow()</code></a>,
which multiples two numbers together, adds a third and then raises the
result to a power. This is obviously a bit of a silly function for this
demostration, but we use it to create a simpler function, <a
href="https://github.com/SBOHVM/practicalA5/blob/master/R/muladd.R"><code>muladd()</code></a>,
which uses <code>muladdpow()</code> but sets the power to 1 to create a
function that just multiples two numbers together and then adds a third.
Finally, we create two even simpler functions <a
href="https://github.com/SBOHVM/practicalA5/blob/master/R/mul.R"><code>mul()</code></a>
and <a
href="https://github.com/SBOHVM/practicalA5/blob/master/R/add.R"><code>add()</code></a>,
which use <code>muladd()</code> to just multiply and add respectively.
You can look at the code for this online or try it out with
<code>devtools::install_github("SBOHVM/practicalA5")</code>.</p>
</blockquote>
<p>You will need to write your species richnes and Simpson index
functions like these functions above, so that rather than calculating
the values directly in the function like you did in Project 1, they call
your general diversity function. Note the functions you write here
should produce exactly the same answers as the functions you wrote in
the previous exercise when called with the same argument.</p>
</div>
<div id="section-running-the-code" class="section level3">
<h3>Running the code</h3>
<p>Run the three functions on the populations provided and check that
your results are identical to the original functions (though the
diversity of <code>rand.pop</code>, <code>quadrat.pop</code> and
<code>quadrat10.pop</code> will only be the same if you use the same
random set of values / run them at the same time!). Remember that to run
both sets of functions in the same script you will need to make sure
that the functions have different names or they will overwrite one
another.</p>
<p>You will almost certainly find that <code>one.pop</code> now has a
different species richness (if not, then well done though!). This is
probably because you are not looking only at the non-zero species
abundances. If so, rewrite your code to exclude zeros from the
proportions.</p>
<blockquote>
<p><em>Hint:</em> remember that <code>a[a &lt; 3]</code> will return
those elements of a vector a which are less than 3.</p>
</blockquote>
<p>Note that here, and throughout these exercises, if you want to – it’s
not compulsory – you can check the values of the diversity function
itself by loading in the <code>rdiversity</code> library, and then
creating a metacommunity from a population and calculating its
metacommunity gamma diversity with the right values of the
<code>qs</code> argument.</p>
</div>
</div>
<div id="section-demo" class="section level2">
<h2>Demo</h2>
<p>Write a demo that loads your package (and therefore the functions
you’ve written from both Project 1 and this exercise) and shows that
each set of functions generate the same results for <span
class="math inline">\(q = 0\)</span> (Species richness) and <span
class="math inline">\(q = 2\)</span> (Simpson index). Your demo will
probably need to start with the same block of code that the last demo
did, so that it generates the same populations. You can just copy it
from one demo to the next (or you may come up with a cleverer way of
dealing with this problem).</p>
<p>Again, your function code should be documented, so remember to build
the documentation for the package.</p>
<div id="section-using-brackets" class="section level3">
<h3>Using brackets</h3>
<p><strong>Important note:</strong> Please remember the order of
calculations (<em>i.e.</em> BODMAS – Brackets, Orders, Division /
Multiplication, Addition / Subtraction). If you do things in the wrong
order you could get any of these:</p>
<p><span class="math display">\[
a^{\frac{b}{c+d}} \neq \frac{a^b}{c}+d \neq \frac{a^b}{c+d} \neq
a^{\frac{b}{c}}+d \neq a^{\frac{b}{c}+d}
\]</span></p>
<p>Generally, if you have an equation then do the things that are
grouped most tightly together first (within clusters or brackets do the
raising to the power first, then the multiplication and division, then
the addition and subtraction). So for <span
class="math inline">\(a^{\frac{b}{c+d}}\)</span>, you calculate <span
class="math inline">\(c+d\)</span> because they are on a line of their
own, then <span class="math inline">\(\frac{b}{c+d}\)</span> because
they cluster together, and only then <span
class="math inline">\(a^{\frac{b}{c+d}}\)</span>. Or you can just use
brackets in the right places to do it all in one go, like this: <span
class="math inline">\(a^{\left( \frac{b}{(c+d)} \right)}\)</span>.</p>
<p>If in doubt, check it by calculating the intermediate bits by hand or
with a calculator and then compare it with your final answer.

<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)
tutorial_options(exercise.reveal_solution = FALSE)
gradethis::gradethis_setup()

knitr::opts_chunk$set(error = TRUE)
set.seed(123)
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["header-attrs"]},{"type":"character","attributes":{},"value":["2.18"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/pandoc"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["header-attrs.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/bootstrap.min.css"]},{"type":"character","attributes":{},"value":["<style>h1 {font-size: 34px;}\n       h1.title {font-size: 38px;}\n       h2 {font-size: 30px;}\n       h3 {font-size: 24px;}\n       h4 {font-size: 18px;}\n       h5 {font-size: 16px;}\n       h6 {font-size: 12px;}\n       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}\n       pre:not([class]) { background-color: white }<\/style>"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87]}},"value":[{"type":"character","attributes":{},"value":["backports","base","bslib","cachem","callr","checkmate","cli","codetools","colorspace","commonmark","compiler","crayon","curl","datasets","deSolve","devtools","digest","dplyr","ellipsis","evaluate","fansi","fastmap","fs","generics","ggplot2","glue","gradethis","graphics","grDevices","grid","gtable","here","highr","htmltools","htmlwidgets","httpuv","jquerylib","jsonlite","knitr","later","learnr","lifecycle","magrittr","markdown","MASS","memoise","methods","mime","miniUI","munsell","pillar","pkgbuild","pkgconfig","pkgload","prettyunits","processx","profvis","promises","ps","purrr","R6","Rcpp","remotes","rlang","rmarkdown","RPiR","rprojroot","rstudioapi","sass","scales","sessioninfo","shiny","stats","stringi","stringr","tibble","tidyselect","tools","urlchecker","usethis","utf8","utils","vctrs","withr","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["1.4.1","4.2.2","0.4.1","1.0.6","3.7.3","2.1.0","3.4.1","0.2-18","2.0-3","1.8.1","4.2.2","1.5.2","4.3.3","4.2.2","1.34","2.4.5","0.6.31","1.0.10","0.3.2","0.18","1.0.3","1.1.0","1.5.2","0.1.3","3.4.0","1.6.2","0.2.11.9000","4.2.2","4.2.2","4.2.2","0.3.1","1.0.1","0.9","0.5.4","1.5.4","1.6.6","0.1.4","1.8.4","1.41","1.3.0","0.11.2.9000","1.0.3","2.0.3","1.4","7.3-58.1","2.0.1","4.2.2","0.12","0.1.1.1","0.5.0","1.8.1","1.4.0","2.0.3","1.3.2","1.1.1","3.8.0","0.3.7","1.2.0.1","1.7.2","0.3.5","2.5.1","1.0.9","2.4.2","1.0.6","2.18","0.76.28","2.0.3","0.14","0.4.4","1.2.1","1.2.2","1.7.3","4.2.2","1.7.8","1.5.0","3.1.8","1.2.0","4.2.2","1.0.1","2.1.6","1.2.2","4.2.2","0.5.1","2.5.0","0.35","1.8-4","2.3.6"]}]}]}
</script>
<!--/html_preserve-->
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
