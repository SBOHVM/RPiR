<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Practical 3-4: Stochastic SIS model</title>

<!-- HEAD_CONTENT -->

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="section-header">



<h1 class="title toc-ignore">Practical 3-4: Stochastic SIS model</h1>

</div>


<div id="section-overview" class="section level2">
<h2>Overview</h2>
<p><em>In this practical we develop and run our first stochastic version
of the SIS model.</em></p>
</div>
<div id="section-background" class="section level2">
<h2>Background</h2>
<p>We saw in the previous practicals the impact of including randomness
into the exponential model with births and deaths. Having developed the
programming framework, it is now time to investigate the impact of
randomness in the simplest epidemiological model – the SIS model.</p>
</div>
<div id="section-tasks" class="section level2">
<h2>Tasks</h2>
<p>In this practical we will write a stochastic version of the SIS
model. You have been provided with <code>run_simulation()</code> in the
<code>RPiR</code> package, which allows some extra functionality over
<code>run_simple()</code> to run simulations using the older
deterministic models. Pay attention in particular to writing the
function, where the most important changes need to be made.</p>
<div id="section-write-a-function" class="section level3">
<h3>1. Write a function</h3>
<p>First, you need to write a new function,
<code>timestep_stochastic_SIS()</code>, adapted from
<code>timestep_stochastic_birth_death()</code> to handle the SIS model
rather than exponential growth.</p>
<p>The function should be defined like this:</p>
<pre class="r"><code>timestep_stochastic_SIS &lt;- function(latest, 
                                    transmission.rate, 
                                    recovery.rate, 
                                    timestep) {
  # Some code
  
}</code></pre>
<p>It proceeds much as before with the deterministic SIS model,
calculating the effective transmission rate (beta) and recovery rate
(sigma) at this timestep. Then as with the stochastic birth death model,
you need to work out whether the individual rate of infection or
recovery per timestep is greater than 1, in which case it cannot be used
as a probability. In this case, the actual individual infection rate is
<code>effective.transmission.rate</code> <span
class="math inline">\(\times \frac{I}{N}\)</span> and the individual
recovery rate is <code>effective.recovery.rate</code>.</p>
<p>Now for the key step… you need to sample from the binomial
distribution (as described in the lecture) to determine the number of
new infecteds and susceptibles using <code>rbinom()</code> with the
probability of “success” set to the individual rates detailed above.
Then update the populations, and if there are no infecteds left, then
the epidemic is over, so set <code>is.finished</code> to
<code>TRUE.</code></p>
<pre class="r"><code>is.finished &lt;- next.infecteds == 0</code></pre>
<p>Then append the new data to the data frame as usual, and return a
list with the updated population data frame and a variable that tells us
whether we are finished or not.</p>
<pre class="r"><code>list(updated.pop = next.population, end.experiment = is.finished)</code></pre>
</div>
<div id="section-write-a-demo" class="section level3">
<h3>2. Write a demo</h3>
<p>Now write a new demo called <span
style="color: #dd1c77;">d0304_run_SIS</span>, to demonstrate the SIS
model. It might be useful to adapt the code you wrote in <span
style="color: #dd1c77;">d0303_run_birth_death</span>.</p>
</div>
<div id="section-check-your-function" class="section level3">
<h3>3. Check your function</h3>
<p>What happens when you do this when the time step is 1? You should get
an error message saying the timestep is too large. You may still get a
plot though! This is because R is plotting the previous value of
populations held in its memory. This is why it’s important to be aware
of your workspace and clear your previous history when you’re working on
a new project (don’t use <code>rm(list=ls())</code> though!).</p>
<blockquote>
<p>Remember that generating a report starts a new copy of R and so is a
much better check of whether the script can run on its own.</p>
</blockquote>
<p>Clear what is held in R’s workspace in RStudio. Now rerun with <span
class="math inline">\(R_0 = 15\)</span> and confirm that you don’t get
an output when the error message shows. Remember that clearing your
workspace and trying again is often a very useful trick when you get
unexpected results.</p>
</div>
</div>
<div id="section-report" class="section level2">
<h2>Report</h2>
<div id="section-compare-stochastic-and-deterministic-models"
class="section level3">
<h3>1. Compare stochastic and deterministic models</h3>
<p>When you are happy with the structure of the code, run it a few times
with a transmission rate of 0.3, a recovery rate of 0.1, and 2 initial
infecteds from a population size of 100. Demonstrate the variability in
the results of the stochastic model.</p>
<p>You should also overlay the deterministic results from Practical 2-3.
Noting that <code>run_simulation()</code> will work with this as well
since it automatically detects that it just returns a dataframe, and
behaves appropriately:</p>
<pre class="r"><code>final.populations &lt;- run_simulation(timestep_deterministic_SIS, 
                                    initial.populations,
                                    end.time,
                                    transmission.rate = ecoli.trans,
                                    recovery.rate = ecoli.recov, 
                                    timestep = working.timestep)</code></pre>
</div>
<div
id="section-vary-the-rate-of-transmission-and-the-initial-number-of-infecteds"
class="section level3">
<h3>2. Vary the rate of transmission and the initial number of
infecteds</h3>
<p>Try varying the transmission rate (beta) – this will change <span
class="math inline">\(R_0\)</span> – and the initial number of infecteds
and see how the likelihood of early extinction changes.</p>
</div>
<div id="section-vary-the-total-population-size" class="section level3">
<h3>3. Vary the total population size</h3>
<p>Try changing the total population size and determine the impact on
the observed variability.</p>
</div>
</div>
<div id="section-check-it-works" class="section level2">
<h2>Check it works</h2>
<p>As with previous exercises, you need to check that everything works
correctly – that the package installs, and the demos and help files work
and you can generate reports from the demos – and then we want you to
get a couple of other people in your subgroup to check your code and
make sure it works for them, and we want you to check other people’s
code too. We describe how to do this for packages in GitHub in Practical
3-1 (also under <em>Check it works</em>) if you’re uncertain.</p>
<p><em>Remember, interacting like this through GitHub to help each other
will count as most of your engagement marks for the course.</em>

<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)

knitr::opts_chunk$set(error = TRUE)
set.seed(123)
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["header-attrs"]},{"type":"character","attributes":{},"value":["2.18"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/pandoc"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["header-attrs.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/bootstrap.min.css"]},{"type":"character","attributes":{},"value":["<style>h1 {font-size: 34px;}\n       h1.title {font-size: 38px;}\n       h2 {font-size: 30px;}\n       h3 {font-size: 24px;}\n       h4 {font-size: 18px;}\n       h5 {font-size: 16px;}\n       h6 {font-size: 12px;}\n       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}\n       pre:not([class]) { background-color: white }<\/style>"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.1.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.18"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87]}},"value":[{"type":"character","attributes":{},"value":["backports","base","bslib","cachem","callr","checkmate","cli","codetools","colorspace","commonmark","compiler","crayon","curl","datasets","deSolve","devtools","digest","dplyr","ellipsis","evaluate","fansi","fastmap","fs","generics","ggplot2","glue","gradethis","graphics","grDevices","grid","gtable","here","highr","htmltools","htmlwidgets","httpuv","jquerylib","jsonlite","knitr","later","learnr","lifecycle","magrittr","markdown","MASS","memoise","methods","mime","miniUI","munsell","pillar","pkgbuild","pkgconfig","pkgload","prettyunits","processx","profvis","promises","ps","purrr","R6","Rcpp","remotes","rlang","rmarkdown","RPiR","rprojroot","rstudioapi","sass","scales","sessioninfo","shiny","stats","stringi","stringr","tibble","tidyselect","tools","urlchecker","usethis","utf8","utils","vctrs","withr","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["1.4.1","4.2.2","0.4.1","1.0.6","3.7.3","2.1.0","3.4.1","0.2-18","2.0-3","1.8.1","4.2.2","1.5.2","4.3.3","4.2.2","1.34","2.4.5","0.6.30","1.0.10","0.3.2","0.18","1.0.3","1.1.0","1.5.2","0.1.3","3.4.0","1.6.2","0.2.11.9000","4.2.2","4.2.2","4.2.2","0.3.1","1.0.1","0.9","0.5.3","1.5.4","1.6.6","0.1.4","1.8.4","1.41","1.3.0","0.11.2.9000","1.0.3","2.0.3","1.4","7.3-58.1","2.0.1","4.2.2","0.12","0.1.1.1","0.5.0","1.8.1","1.4.0","2.0.3","1.3.2","1.1.1","3.8.0","0.3.7","1.2.0.1","1.7.2","0.3.5","2.5.1","1.0.9","2.4.2","1.0.6","2.18","0.76.25","2.0.3","0.14","0.4.4","1.2.1","1.2.2","1.7.3","4.2.2","1.7.8","1.5.0","3.1.8","1.2.0","4.2.2","1.0.1","2.1.6","1.2.2","4.2.2","0.5.1","2.5.0","0.35","1.8-4","2.3.6"]}]}]}
</script>
<!--/html_preserve-->
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
