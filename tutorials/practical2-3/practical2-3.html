<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Practical 2-3: SIS model with timesteps</title>

<!-- HEAD_CONTENT -->

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="section-header">



<h1 class="title toc-ignore">Practical 2-3: SIS model with timesteps</h1>

</div>


<div id="section-overview" class="section level2">
<h2>Overview</h2>
<p><em>In this practical we separate out the model from the simulation functionality more cleanly. In the process we make the previous set of code safer to use (and more elegant!).</em></p>
</div>
<div id="section-background" class="section level2">
<h2>Background</h2>
<p>When we are programming we often make quick additions to code, as we did in the last practical but it is good practice, if we want to keep them, to make sure they are included in the code in a way that makes it clear what’s going on. We had to know how the SIS model works to know that we could get away with multiplying the parameters with <code>timestep.</code> This use of a low-level detail of how the model runs might be risky – we may later change the model and not realise this hack no longer works.</p>
</div>
<div id="section-tasks" class="section level2">
<h2>Tasks</h2>
<p>In the previous practical we multiplied the transmission and recovery rates up (or down) to reflect changes in <code>timestep.</code> However, <code>transmission.rate</code> and <code>recovery.rate</code> were not really changing, and we want the code to reflect that rather than abusing it to do something it wasn’t intended to do. Instead add a new argument, <code>timestep</code>, into <code>step_deterministic_SIS()</code> – we could call it <code>timestep_deterministic_SIS()</code>. Rather than submit the product <code>transmission.rate * timestep</code> as an argument to the simulation function, we can now separately pass the real rate parameters and the <code>timestep</code> separately. This <strong>rescaling</strong> is now done within the function <code>timestep_deterministic_SIS()</code> in <span style="color: #dd1c77;">0203-deterministic-SIS.R</span>. We might, for instance, create two new variables, perhaps called <code>effective.transmission.rate</code> and <code>effective.recovery.rate</code> (or something shorter!) inside that function. These new variables are just our original rates rescaled to match the new time scale.</p>
<p>Now that we have a timestep in the step function, it makes sense to have the time in there too, and that can be updated inside the function. Indeed, the data frame itself that is passed back and forth can have an extra column. This should start in the new report script that you are writing (perhaps <span style="color: #dd1c77;">0203-run-SIS.R</span>), where it will be initialised with all three columns (<code>time</code>, <code>susceptibles</code> and <code>infecteds</code>):</p>
<pre class="r"><code>population.df &lt;- data.frame(time = start.time,
                            susceptibles = initial.susceptibles,
                            infecteds = initial.infecteds)</code></pre>
<p>And the <code>timestep_deterministic_SIS()</code> function can update the time along with the number of susceptibles and infecteds. Here, it makes the code slightly more elegant but it might be critical if, for instance, we wanted to adjust the timestep as we went along, which we will need to do later. Now we’re not making the vector of timesteps in advance, we can use a <code>while()</code> loop to decide when we’re finished. For instance:</p>
<pre class="r"><code>latest.population &lt;- population.df
while (latest.population$time &lt; end.time) {
  latest.population &lt;- timestep_deterministic_SIS(latest = latest.population,
                                                  transmission.rate = ecoli.transmission, 
                                                  recovery.rate = ecoli.recovery, 
                                                  timestep = this.timestep)
  population.df &lt;- rbind(population.df, latest.population) 
}</code></pre>
<p><code>latest.population$time</code> is the time that we are currently at, which we extract from the data frame after each timestep.</p>
</div>
<div id="section-running-the-code" class="section level2">
<h2>Running the code</h2>
<p>Run this code and check that it gives the same answers as in the previous practical. Don’t forget to check that your function is using only arguments passed to it by running <code>findGlobals()</code>.</p>
</div>
<div id="section-report" class="section level2">
<h2>Report</h2>
<p>Demonstrate that the code is the same in a report by running both <code>step_deterministic_SIS()</code> and <code>timestep_deterministic_SIS()</code> with a couple of different values of timestep (using <code>source()</code> to load in both functions from their respective files).</p>
</div>
<div id="section-github" class="section level2">
<h2>GitHub</h2>
<p>As with the other exercises, we want you to get a couple of other people to check your code and make sure it works for them, and we want you to check other people’s code too.</p>
<div id="section-getting-help-with-your-code" class="section level3">
<h3>Getting help with your code</h3>
<p>Once you’re happy with your code, commit your changes using the Git pane in RStudio (it’s best just to commit the R files for now - not, for instance, any html files that were created by generating reports). Don’t forget then to push the changes to GitHub and check on the website that it contains your new code. Notify the partners we have allocated you that you have something for them to check. You can do this on Zoom, but please also create an issue in your repository asking for their review - you can contact them by tagging them in the message with <code>@theirusername</code>, and they should receive an email and a <a href="https://github.com/notifications">notification on the website</a>. They can then respond to this issue, telling you whether they had any problems running your version of the practical.</p>
</div>
<div id="section-checking-other-peoples-code" class="section level3">
<h3>Checking other people’s code</h3>
<p>Likewise, when you hear from someone else that a repo is available to check, then if it’s a project you have already downloaded, you should open that project in RStudio, go to the Git pane, and click on the <span style="color: #dd1c77;">Pull</span> button to get the updates they have pushed to GitHub (there should be a subtle message saying that updates are available near the button). If you’re checking a new person’s work, or a new project, refer to the instructions in Practical 2-1. Once you’ve checked that the new code has downloaded, you can then run their code and make sure it works. If it does not, just respond in the Issue that they opened on GitHub explaining what went wrong (it might help to also do this in person on Zoom if they are there). If it works, then you also need to respond saying so.</p>
Interacting like this through GitHub to help each other will count as most of your engagement marks for the course. 
<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)

knitr::opts_chunk$set(error = TRUE)
set.seed(123)
</script>
 <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/bootstrap.min.css"]},{"type":"character","attributes":{},"value":["<style>h1 {font-size: 34px;}\n       h1.title {font-size: 38px;}\n       h2 {font-size: 30px;}\n       h3 {font-size: 24px;}\n       h4 {font-size: 18px;}\n       h5 {font-size: 16px;}\n       h6 {font-size: 12px;}\n       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}\n       pre:not([class]) { background-color: white }<\/style>"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.11"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.6.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/3.6.0"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery-3.6.0.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquerylib"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.11"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.11"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84]}},"value":[{"type":"character","attributes":{},"value":["backports","base","bslib","cachem","callr","checkmate","cli","codetools","colorspace","compiler","crayon","curl","datasets","desc","deSolve","devtools","digest","dplyr","ellipsis","evaluate","fansi","fastmap","fs","generics","ggplot2","glue","gradethis","graphics","grDevices","grid","gtable","highr","htmltools","htmlwidgets","httpuv","jquerylib","jsonlite","knitr","later","learnr","lifecycle","magrittr","markdown","MASS","memoise","methods","mime","munsell","pillar","pkgbuild","pkgconfig","pkgload","prettyunits","processx","promises","ps","purrr","R6","Rcpp","remotes","rlang","rmarkdown","RPiR","rprojroot","rstudioapi","sass","scales","sessioninfo","shiny","stats","stringi","stringr","testthat","tibble","tidyselect","tools","usethis","utf8","utils","vctrs","withr","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["1.4.0","4.1.2","0.3.1","1.0.6","3.7.0","2.0.0","3.1.0","0.2-18","2.0-2","4.1.2","1.4.2","4.3.2","4.1.2","1.4.0","1.30","2.4.2","0.6.28","1.0.7","0.3.2","0.14","0.5.0","1.1.0","1.5.0","0.1.1","3.3.5","1.5.0","0.2.4.9000","4.1.2","4.1.2","4.1.2","0.3.0","0.9","0.5.2","1.5.4","1.6.3","0.1.4","1.7.2","1.36","1.3.0","0.10.1.9017","1.0.1","2.0.1","1.1","7.3-54","2.0.0","4.1.2","0.12","0.5.0","1.6.4","1.2.0","2.0.3","1.2.3","1.1.1","3.5.2","1.2.0.1","1.6.0","0.3.4","2.5.1","1.0.7","2.4.1","0.4.12","2.11","0.72.2","2.0.2","0.13","0.4.0","1.1.1","1.2.1","1.7.1","4.1.2","1.7.5","1.4.0","3.1.0","3.1.6","1.1.1","4.1.2","2.1.3","1.2.2","4.1.2","0.3.8","2.4.2","0.28","1.8-4","2.2.1"]}]}]}
</script>
<!--/html_preserve-->
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
